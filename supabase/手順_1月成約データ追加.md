# 1月分成約データ追加手順

## 問題
1月分の成約データが`contracts`テーブルに反映されていません。
スクリーンショットの数字：
- 吉田: ¥2,074,074
- 鈴木: ¥1,110,162
- 瀧澤: ¥777,750
- 松澤: ¥1,550,000
- **合計: ¥5,511,986**

## 原因
月次マージシートには成約金額の情報がありますが、`contracts`テーブルには別途インポートが必要です。
成約データは通常、専用のCSVファイル（`成約YYYY_MM.csv`）からインポートしますが、1月分のCSVファイルがまだありません。

## 解決方法
月次マージシートから成約データを抽出して`contracts`テーブルに追加します。

---

## 手順

### ステップ1: データ確認

まず、月次マージシートに1月分の成約データが正しく入っているか確認します。

1. Supabase Dashboard → **SQL Editor** を開く
2. `verify_january_contracts.sql` を実行

期待される結果：
- 成約件数: 5件
- 成約額合計: ¥5,511,986
- 担当者別:
  - 吉田: 2件, ¥2,074,074
  - 鈴木: 1件, ¥1,110,162
  - 瀧澤: 1件, ¥777,750
  - 松澤: 1件, ¥1,550,000

### ステップ2: 成約データをインポート

1. Supabase Dashboard → **SQL Editor** を開く
2. `import_january_contracts.sql` の内容をコピー＆ペースト
3. **Run** ボタンをクリック

### ステップ3: 結果確認

SQLの最後に確認クエリが含まれているので、実行結果で以下を確認：

1. **1月分成約データ追加結果**
   - `total_contracts`: 5件
   - `total_revenue`: ¥5,511,986

2. **担当者別の成約額確認**
   - 各担当者の成約件数と合計金額が正しく表示される

---

## 注意事項

- **承諾日**: 月次マージシートには承諾日の情報がないため、割り振り日から推測するか、2026年1月1日をデフォルトとしています
- **税抜・税込**: 月次マージシートの「成約金額」は税込として扱い、税抜は税込÷1.1で計算します
- **重複防止**: 同じ`candidate_id`で2026年1月の成約データが既に存在する場合はスキップされます
- **入職先**: 月次マージシートには園名情報がないため、すべて「未設定」になります

---

## トラブルシューティング

### エラー: "relation stg_member_monthly does not exist"
→ 先に`stg_member_monthly`テーブルに1月分のデータをインポートしてください（`insert_january_data.sql`を実行）

### エラー: "duplicate key value violates unique constraint"
→ 既に同じ成約データが存在している可能性があります。確認クエリで既存データを確認してください

### 数字が合わない
→ `verify_january_contracts.sql`で月次マージシートのデータを確認し、スクリーンショットの数字と比較してください
