# 担当者フィルタで「出てこない」ときの原因調査

## 画面で確認すること

1. **検索欄**
   - 氏名・IDで検索をかけていると、**担当者で絞ったうえでさらに検索**がかかります。
   - 「担当は吉田なのに誰々が出てこない」→ いったん検索欄を**空**にして、担当者「吉田」だけの状態で一覧を確認してください。

2. **件数メッセージ**
   - 担当者を選んだとき、フィルター直下に  
     「担当者「吉田」で絞り込み中。」  
     と出ます。検索もかけている場合は  
     「さらに検索「〇〇」を適用しています。検索欄を空にすると該当担当の全員が表示されます。」  
     と出ます。
   - 「該当は全○件あります。表示は最大1000件までです。」と出る場合は、該当者が1000件を超えており、超えた分は表示されません（検索で絞ると見やすくなります）。

3. **タブ「全体」と「今日のタスク」**
   - 「今日のタスク」では、特定ステータス（初回連絡中・面接調整中など）の人だけが対象です。
   - 担当者で絞ったうえで「全体」タブにすると、その担当の**全員**が対象になります。

---

## DBで「吉田」担当の人数を確認する

Supabase の SQL Editor で次を実行すると、**吉田さんを担当に持つ候補者数**が分かります。

```sql
-- 吉田さんの user id を取得して、その id を担当に持つ候補者数を数える
SELECT u.id, u.name, COUNT(c.id) AS candidate_count
FROM users u
LEFT JOIN candidates c ON c.consultant_id = u.id
WHERE u.name = '吉田'
GROUP BY u.id, u.name;
```

- `candidate_count` が、DB 上で「吉田」担当の人数です。
- 一覧の「全体 (N)」の N は、API が返した件数です。  
  N がこの `candidate_count` より少ない場合は、**取得上限（最大1000件）** で切れているか、**検索条件**で絞られています。

---

## 想定される原因の整理

| 状況 | 想定原因 |
|------|----------|
| 検索欄に文字を入れている | 担当者＋検索の両方で絞られている。検索を空にすると出る可能性あり。 |
| 「全体」ではなく「今日のタスク」を選んでいる | 今日のタスク対象ステータス以外の人は一覧に出ない。 |
| 該当が1000件を超えている | 表示は最大1000件。検索で絞るか、担当者を分けて確認。 |
| DB の consultant_id が別の担当になっている / null | スプレッドシート取り込みや手動変更で、担当が別の人 or 未設定になっている可能性。上記 SQL で人数を確認し、必要なら `candidates.consultant_id` を修正。 |
