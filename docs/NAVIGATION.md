# 画面遷移とナビゲーション

> **重要**: このドキュメントは画面間の関係と遷移ルールを記載しています。AIエージェントが画面遷移を実装・修正する際の判断基準として使用してください。

## 画面遷移図

```mermaid
graph TD
    Login[ログイン /login] --> Dashboard[ダッシュボード /]
    Dashboard --> Candidates[求職者管理 /candidates]
    Dashboard --> Contracts[成約管理 /contracts]
    Dashboard --> Interviews[面接一覧 /interviews]
    
    Candidates --> CandidateDetail[求職者詳細 /candidates/[id]]
    Interviews --> CandidateDetail
    
    CandidateDetail --> Candidates
    
    Contracts --> CandidateDetail
```

## 各画面から遷移できる画面

### ダッシュボード (`/`)

**遷移先**:
- サイドバーからすべての画面に遷移可能

**URLパラメータ**: なし

### 求職者管理 (`/candidates`)

**遷移先**:
- サイドバーからすべての画面に遷移可能
- 求職者一覧の氏名をクリック → 求職者詳細ページ（`/candidates/[id]`）
- 求職者一覧の詳細リンク（右端の矢印）をクリック → 求職者詳細ページ（`/candidates/[id]`）

**URLパラメータ**: なし

### 求職者詳細 (`/candidates/[id]`)

**遷移先**:
- 戻るボタンをクリック → 遷移元に応じて戻る
  - `from=members`パラメータがある場合 → メンバーページ（`/members?selected={memberId}`）
  - それ以外 → ブラウザの履歴を戻る（通常は求職者管理ページ）
- サイドバーからすべての画面に遷移可能

**URLパラメータ**:
- `id`: 求職者ID（必須、パスパラメータ）
- `from`: 遷移元（オプション、`members`など）
- `memberId`: メンバーID（`from=members`の場合に使用）

**実装ファイル**: `src/app/candidates/[id]/page.tsx` (103-116行目)

### 成約管理 (`/contracts`)

**遷移先**:
- サイドバーからすべての画面に遷移可能
- 成約一覧の氏名をクリック → 求職者詳細ページ（実装予定）

**URLパラメータ**: なし

### メンバー (`/members`)

**注意**: メンバーページはサイドバーナビゲーションから削除されました。求職者管理画面の担当者フィルタでメンバー別の求職者を確認できます。メンバーページは直接URLでアクセス可能ですが、通常の利用では求職者管理画面を使用してください。

**遷移先**:
- メンバーリストからメンバーを選択 → 同じページ内で詳細表示
- 担当求職者一覧の氏名をクリック → 求職者詳細ページ（`/candidates/[id]?from=members&memberId={memberId}`）

**URLパラメータ**:
- `selected`: 選択されたメンバーID（オプション）

**実装ファイル**: `src/app/members/page.tsx` (45-56行目, 236行目)

### 面接一覧 (`/interviews`)

**遷移先**:
- サイドバーからすべての画面に遷移可能
- 面接一覧の求職者名をクリック → 求職者詳細ページ（実装予定）

**URLパラメータ**: なし

## サイドバーナビゲーション

### 構成

サイドバーには以下のメニュー項目があります：

1. **ダッシュボード** (`/`)
2. **求職者管理** (`/candidates`) - 今日のタスク機能も統合、担当者フィルタでメンバー別の求職者を確認可能
3. **成約管理** (`/contracts`)
4. **面接一覧** (`/interviews`)
5. **設定** (実装予定)

**注意**: メンバーページ (`/members`) はサイドバーから削除されました。メンバー別の求職者を確認する場合は、求職者管理画面の担当者フィルタを使用してください。

### 実装ファイル

`src/components/layout/sidebar.tsx`

### 動作

- すべての画面で共通して表示される
- メニュー項目をクリックすると、該当ページに遷移
- 現在のページはハイライト表示される

## URLパラメータの意味と使い方

### パスパラメータ

#### `/candidates/[id]`

- **`id`**: 求職者ID（8桁の数字、例: `20206444`）
- **必須**: はい
- **用途**: 求職者詳細ページで表示する求職者を指定

### クエリパラメータ

#### `from`

- **用途**: 遷移元を指定
- **値**: `members`など
- **使用例**: `/candidates/20206444?from=members&memberId=1`
- **動作**: 戻るボタンの動作を決定

#### `memberId`

- **用途**: メンバーページから遷移した場合のメンバーID
- **値**: ユーザーID（例: `1`）
- **使用例**: `/candidates/20206444?from=members&memberId=1`
- **動作**: 戻るボタンでメンバーページに戻る際に使用

#### `selected`

- **用途**: メンバーページで選択されたメンバーID
- **値**: ユーザーID（例: `1`）
- **使用例**: `/members?selected=1`
- **動作**: ページ読み込み時に指定されたメンバーを選択状態にする

## 戻るボタンの動作

### 求職者詳細ページの戻るボタン

**実装ファイル**: `src/app/candidates/[id]/page.tsx` (103-116行目)

**動作ロジック**:

```typescript
const handleBack = () => {
  if (from === 'members' && memberId) {
    // メンバーページから来た場合は、選択状態を保持してメンバーページに戻る
    router.push(`/members?selected=${memberId}`)
  } else {
    // それ以外の場合はブラウザの履歴を戻る
    router.back()
  }
}
```

**判断基準**:
1. `from=members`パラメータがあり、`memberId`も指定されている場合
   → `/members?selected={memberId}`に遷移
2. それ以外の場合
   → `router.back()`でブラウザの履歴を戻る（通常は求職者管理ページ）

### その他の画面

- **戻るボタンなし**: ダッシュボード、求職者管理、成約管理、面接一覧には戻るボタンがない
- **サイドバーで遷移**: サイドバーに表示されている画面はサイドバーから遷移可能

## 認証が必要な画面と不要な画面

### 認証不要（現時点）

- **ログインページ** (`/login`): 認証画面自体

### 認証必要（現時点）

- **すべてのその他の画面**: ダッシュボード、求職者管理、求職者詳細、成約管理、メンバー、面接一覧

**注意**: プロトタイプでは認証機能は実装されていないが、本番環境ではすべての画面で認証が必要になる予定。

## 画面遷移の実装パターン

### Next.jsのルーティング

- **App Router**: Next.js 14のApp Routerを使用
- **ファイルベースルーティング**: `src/app/`ディレクトリ内のファイル構造がルートになる

### 遷移方法

1. **Linkコンポーネント**: 
   ```tsx
   <Link href="/candidates/20206444">求職者詳細</Link>
   ```

2. **router.push()**: 
   ```tsx
   router.push(`/members?selected=${memberId}`)
   ```

3. **router.back()**: 
   ```tsx
   router.back()
   ```

### URLパラメータの取得

- **パスパラメータ**: `params`から取得（`async`関数で`use()`を使用）
- **クエリパラメータ**: `useSearchParams()`から取得

**実装例**:
```typescript
// パスパラメータ
const { id } = use(params)

// クエリパラメータ
const searchParams = useSearchParams()
const from = searchParams.get('from')
const memberId = searchParams.get('memberId')
```

## AIエージェント向けの判断基準

### 画面遷移を実装する時

1. **遷移先の決定**: ユーザーが何をしたいかを考える
   - 求職者詳細を確認したい → `/candidates/[id]`
   - メンバー別の求職者を確認したい → 求職者管理画面 (`/candidates`) の担当者フィルタを使用

2. **URLパラメータの使用**: 遷移元の情報を保持する必要がある場合
   - 戻るボタンの動作を制御する → `from`パラメータを使用
   - 選択状態を保持する → `selected`パラメータを使用

3. **戻るボタンの実装**: 遷移元に応じて動作を変更
   - メンバーページから来た場合 → メンバーページに戻る
   - それ以外 → ブラウザの履歴を戻る

### リンクを追加する時

1. **Linkコンポーネントを使用**: Next.jsの`Link`コンポーネントを使用
2. **パスパラメータ**: 動的な値はテンプレートリテラルで指定
3. **クエリパラメータ**: `?`以降に指定

### URLパラメータを処理する時

1. **必須パラメータ**: パスパラメータとして定義（`[id]`など）
2. **オプションパラメータ**: クエリパラメータとして定義（`?from=members`など）
3. **デフォルト値**: パラメータがない場合の動作を定義

## 関連ドキュメント

- [システム目的と設計思想](./SYSTEM_PURPOSE.md) - システムの基本方針
- [画面仕様とビジネスロジック](./SCREEN_LOGIC.md) - 各画面の詳細仕様
- [データフローと状態管理](./DATA_FLOW.md) - データの流れ
