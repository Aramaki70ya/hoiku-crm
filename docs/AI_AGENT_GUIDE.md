# AIエージェント向け判断ガイド

> **重要**: このドキュメントはAIエージェントが判断に迷った時に参照するガイドです。よくある判断ミスと正しい判断を記載しています。

## よくある判断ミスと正しい判断

### 1. データソースの混同

**❌ 間違った判断**:
- Supabaseからデータを取得しようとする（プロトタイプでは未実装）
- データを変更したら、mock-data.tsを直接編集する

**✅ 正しい判断**:
- プロトタイプでは`mock-data.ts`からデータを取得する
- データの変更は`useState`で管理し、`mock-data.ts`には反映しない
- 本番環境ではSupabaseを使用するが、現時点では実装されていない

**参照ドキュメント**: [データフローと状態管理](./DATA_FLOW.md)

### 2. 状態管理の過剰な複雑化

**❌ 間違った判断**:
- 複雑な状態管理ライブラリ（Redux、Zustandなど）を導入する
- グローバルな状態管理コンテキストを作成する

**✅ 正しい判断**:
- `useState`と`useMemo`で十分な場合は、それを使用する
- 画面間で共有する必要があるデータのみ`localStorage`を使用（タイムラインイベントなど）
- シンプルな状態管理を維持する

**参照ドキュメント**: [データフローと状態管理](./DATA_FLOW.md)

### 3. UIの一貫性の欠如

**❌ 間違った判断**:
- 新しいUIコンポーネントライブラリを導入する
- 既存のカラースキームと異なる色を使用する
- 既存のレイアウトパターンと異なるレイアウトを採用する

**✅ 正しい判断**:
- Shadcn/UIのコンポーネントを使用する（既存のコンポーネントを再利用）
- 既存のカラースキームに従う（バイオレット/インディゴをプライマリ、グリーン/エメラルドを成功など）
- 既存のレイアウトパターンに従う（`AppLayout`コンポーネントを使用）

**参照ドキュメント**: [画面仕様とビジネスロジック](./SCREEN_LOGIC.md)

### 4. ビジネスロジックの無視

**❌ 間違った判断**:
- ステータス遷移ルールを無視して、任意のステータスに遷移できるようにする
- 成約時の自動処理を実装しない
- 担当者変更時の連動更新を実装しない

**✅ 正しい判断**:
- ビジネスルールに従う（ステータス遷移、自動処理など）
- 関連データの連動更新を必ず実装する
- タイムラインイベントの作成を忘れない

**参照ドキュメント**: [ビジネスルール集](./BUSINESS_RULES.md)

### 5. データの整合性を損なう

**❌ 間違った判断**:
- 面接の担当者を変更したが、求職者の担当者を更新しない
- ステータスを`closed_won`に変更したが、`contracts`にレコードを作成しない
- タイムラインイベントを作成しない

**✅ 正しい判断**:
- 関連するデータは常に同期を保つ
- 自動処理は必ず実行する
- タイムラインイベントは必ず作成する

**参照ドキュメント**: [ビジネスルール集](./BUSINESS_RULES.md), [データフローと状態管理](./DATA_FLOW.md)

## 変更を加える前に確認すべきこと

### 1. システムの目的に沿っているか

- この変更はシステムの目的（データの一元管理、業務効率化）に沿っているか？
- ユーザーが何をしたいかを理解しているか？

**参照ドキュメント**: [システム目的と設計思想](./SYSTEM_PURPOSE.md)

### 2. データの整合性を損なわないか

- この変更が他の画面やデータに影響しないか？
- 関連するデータの連動更新が必要か？
- 自動処理を実行する必要があるか？

**参照ドキュメント**: [データフローと状態管理](./DATA_FLOW.md), [ビジネスルール集](./BUSINESS_RULES.md)

### 3. 既存の機能を壊さないか

- 既存の機能に影響しないか？
- 既存のパターンに従っているか？
- テストが必要か？

### 4. ユーザーの使いやすさを損なわないか

- UIが直感的か？
- 操作手順が複雑になっていないか？
- エラーメッセージが適切か？

## データを変更する際の注意点

### 1. データソースの確認

- **プロトタイプ**: `mock-data.ts`から取得（読み取り専用）
- **変更**: `useState`で管理（画面内でのみ有効）
- **本番環境（将来）**: Supabaseに保存

### 2. 関連データの連動更新

- 面接の担当者を変更したら、求職者の担当者も更新
- ステータスを`closed_won`に変更したら、`contracts`にレコードを作成
- タイムラインイベントを作成

### 3. データの優先順位

1. **変更されたデータ**（`candidateStatuses`, `interviewStatuses`など）: 最優先
2. **元のデータ**（`mock-data.ts`）: 変更されていない場合のフォールバック

### 4. タイムラインイベントの作成

- ステータス変更時: 必ずタイムラインイベントを作成
- 担当者変更時: 必ずタイムラインイベントを作成
- 保存先: `localStorage`（`timelineEvents`キー）

**参照ドキュメント**: [データフローと状態管理](./DATA_FLOW.md), [ビジネスルール集](./BUSINESS_RULES.md)

## UIを変更する際の注意点

### 1. 既存のコンポーネントを使用

- Shadcn/UIのコンポーネントを使用（`Card`, `Badge`, `Button`, `Table`, `Select`など）
- 既存のコンポーネントを再利用する

### 2. カラースキームに従う

- **プライマリ**: バイオレット/インディゴ（`violet-500` → `indigo-600`）
- **成功**: グリーン/エメラルド（`green-500`, `emerald-600`）
- **警告**: オレンジ/アンバー（`orange-500`, `amber-600`）
- **重要**: ローズ/レッド（`rose-500`, `red-600`）
- **情報**: スレート/グレー（`slate-500`, `slate-600`）

### 3. レイアウトパターンに従う

- `AppLayout`コンポーネントを使用（サイドバー、ヘッダーを含む）
- 既存のレイアウトパターンに従う

### 4. アクセシビリティ

- 適切なラベルとaria属性を使用
- キーボード操作に対応
- 色だけでなく、アイコンやテキストでも情報を伝える

**参照ドキュメント**: [画面仕様とビジネスロジック](./SCREEN_LOGIC.md)

## 新機能を追加する際の判断基準

### 1. システムの目的に沿っているか

- この機能はシステムの目的（データの一元管理、業務効率化）に貢献するか？
- ユーザーが本当に必要としている機能か？

### 2. 既存の機能と整合性があるか

- 既存の機能と矛盾しないか？
- 既存のパターンに従っているか？
- 既存のデータ構造と整合性があるか？

### 3. 実装の複雑さ

- シンプルに実装できるか？
- 過剰に複雑になっていないか？
- 既存のコードベースに自然に統合できるか？

### 4. データの扱い方

- データはどこから取得するか？（`mock-data.ts` / Supabase / `localStorage`）
- データはどこに保存するか？（`useState` / Supabase / `localStorage`）
- データの整合性をどう保つか？

**参照ドキュメント**: [システム目的と設計思想](./SYSTEM_PURPOSE.md), [データフローと状態管理](./DATA_FLOW.md)

## エラーハンドリング

### 1. データが存在しない場合

- `null`や`undefined`のチェックを必ず行う
- デフォルト値を設定する（例: `'-'`, `0`, `[]`）

### 2. 計算時のゼロ除算

- 分母が0の場合は0を返す
- 例: `const rate = total > 0 ? (count / total) * 100 : 0`

### 3. ユーザーへのフィードバック

- エラーメッセージを適切に表示
- 成功メッセージを表示（必要に応じて）

## パフォーマンス最適化

### 1. useMemoの使用

- 計算コストの高い処理の結果をキャッシュ
- 依存する値が変わった時のみ再計算

### 2. 不要な再レンダリングの防止

- `useMemo`で計算結果をキャッシュ
- コンポーネントの分割（必要に応じて）

### 3. データの取得

- 必要なデータのみ取得
- 不要なデータの取得を避ける

## ドキュメントの参照順序

AIエージェントが判断に迷った時は、以下の順序でドキュメントを参照してください：

1. **最初に**: [システム目的と設計思想](./SYSTEM_PURPOSE.md)
   - システムの目的と基本方針を確認

2. **次に**: [画面仕様とビジネスロジック](./SCREEN_LOGIC.md)
   - 該当画面の詳細仕様を確認

3. **データ関連**: [データフローと状態管理](./DATA_FLOW.md)
   - データの扱い方を確認

4. **ルール関連**: [ビジネスルール集](./BUSINESS_RULES.md)
   - システムの動作ルールを確認

5. **遷移関連**: [画面遷移とナビゲーション](./NAVIGATION.md)
   - 画面遷移のルールを確認

6. **判断に迷った時**: このドキュメント（AI_AGENT_GUIDE.md）
   - よくある判断ミスと正しい判断を確認

## 関連ドキュメント

- [システム目的と設計思想](./SYSTEM_PURPOSE.md) - システムの基本方針
- [画面仕様とビジネスロジック](./SCREEN_LOGIC.md) - 各画面の詳細仕様
- [データフローと状態管理](./DATA_FLOW.md) - データの流れ
- [ビジネスルール集](./BUSINESS_RULES.md) - システムの動作ルール
- [画面遷移とナビゲーション](./NAVIGATION.md) - 画面遷移のルール
