# Hoiku CRM 実装チェックリスト

このドキュメントは、システム完成までに必要な実装項目をまとめています。

---

## 1. ダッシュボード（優先度：高）

### 1.1 期間フィルタリング機能
- [ ] 期間選択に応じたデータフィルタリングの実装
  - [ ] 売上データのフィルタリング（`contracts.contracted_at`）
  - [ ] 登録者数のフィルタリング（`candidates.registered_at`）
  - [ ] 面接数のフィルタリング（`interviews.start_at`）
  - [ ] 成約数のフィルタリング（`contracts.contracted_at`）
- [ ] 残り営業日の動的計算
  - [ ] 営業日カレンダーの実装（祝日除外）
  - [ ] 選択期間に応じた残り営業日計算

### 1.2 予算管理機能
- [ ] 予算設定画面の作成
  - [ ] 月次予算の入力・保存
  - [ ] 予算の履歴管理
- [ ] 予算取得ロジックの実装
  - [ ] 選択期間に応じた予算の取得
  - [ ] 指定期間の日割り計算（複数月にまたがる場合）

### 1.3 KPI計算ロジックの修正
- [ ] 登録→初回率：選択期間内の登録者数を分母に
- [ ] 初回→面接率：選択期間内に面接設定した人数を分子に
- [ ] 面接→成約率：選択期間内の値を使用
- [ ] 成約単価：選択期間内の値を使用

### 1.4 Aヨミ/Bヨミの計算
- [ ] `projects`テーブルからヨミ金額を集計
- [ ] 確度別（A/B/C/D）の金額集計ロジック
- [ ] 期間フィルタリングの適用（作成日または更新日）

---

## 2. 求職者管理（優先度：高）

### 2.1 CRUD機能
- [ ] 新規登録機能
  - [ ] 新規登録ダイアログの作成
  - [ ] バリデーションの実装
  - [ ] Supabaseへの保存
- [ ] 編集機能
  - [ ] 編集ダイアログの作成
  - [ ] 既存データの読み込み
  - [ ] 更新処理の実装
- [ ] 削除機能（論理削除）
  - [ ] 削除確認ダイアログ
  - [ ] 論理削除フラグの実装

### 2.2 ステータス変更
- [ ] ステータス変更時のバリデーション
- [ ] ステータス変更履歴の自動記録（`status_history`テーブル）
- [ ] `closed_won`への変更時に成約レコードを自動作成

### 2.3 担当者変更
- [ ] 担当者変更時のバリデーション
- [ ] 担当者変更履歴の記録
- [ ] 関連する案件・面接の担当者も連動更新

### 2.4 優先度管理
- [ ] アプローチ優先度の変更・保存
- [ ] ランクの表示・変更
- [ ] 優先度自動判定ルールの実装

---

## 3. 成約管理（優先度：高）

### 3.1 期間フィルタリング
- [ ] 月選択に応じたデータフィルタリング
- [ ] 担当者フィルターの実装

### 3.2 成約情報の編集
- [ ] インライン編集機能
  - [ ] 承諾日の編集
  - [ ] 売上（税抜/税込）の編集
  - [ ] 入金予定日/入金日の編集
  - [ ] 請求書発行日の編集
- [ ] 保存処理の実装

### 3.3 キャンセル対応機能
- [ ] キャンセルダイアログの作成
- [ ] 返金情報の入力・保存
  - [ ] 返金あり/なしフラグ
  - [ ] 返金日
  - [ ] 返金額
  - [ ] キャンセル理由
- [ ] キャンセル済み表示の実装

### 3.4 担当者別集計
- [ ] 担当者別の成約件数・売上の集計
- [ ] 担当者別カードの表示

---

## 4. 面接一覧（優先度：中）

### 4.1 CRUD機能
- [ ] 面接の新規登録
  - [ ] 日時、場所、面接先の入力
  - [ ] 求職者・案件との紐付け
- [ ] 面接情報の編集
- [ ] 面接のキャンセル

### 4.2 ステータス管理
- [ ] ステータス変更（予定→完了/キャンセル）
- [ ] ステータス変更時のタイムラインイベント作成
- [ ] フィードバックの入力・保存

### 4.3 担当者変更
- [ ] 担当者変更時のバリデーション
- [ ] 関連する求職者の担当者連動更新
- [ ] タイムラインイベントの作成

---

## 5. 求職者詳細（優先度：中）

### 5.1 ヨミ情報管理
- [ ] ヨミ確度の選択・保存
- [ ] ヨミ金額の入力・保存
- [ ] ヨミ情報の変更履歴

### 5.2 タイムライン
- [ ] ステータス変更履歴の表示
- [ ] メモの表示（時系列）
- [ ] 面接結果の表示
- [ ] 担当者変更の表示

### 5.3 選考状況
- [ ] 案件一覧の表示
- [ ] 案件の追加
- [ ] 案件の編集・削除
- [ ] 面接予定の表示

### 5.4 メモ機能
- [ ] メモの追加
- [ ] メモの編集
- [ ] メモの削除

### 5.5 基本情報編集
- [ ] 編集ダイアログの作成
- [ ] バリデーションの実装
- [ ] 更新処理の実装

---

## 6. 設定画面（優先度：中）

### 6.1 ユーザー管理
- [ ] ユーザー一覧表示
- [ ] ユーザー追加
- [ ] ユーザー編集
- [ ] パスワードリセット
- [ ] ユーザー削除（論理削除）

### 6.2 マスタ管理
- [ ] 媒体（流入経路）マスタ
  - [ ] 一覧表示
  - [ ] 追加・編集・削除
- [ ] ステータスマスタ
  - [ ] 一覧表示
  - [ ] 並び順の変更

### 6.3 システム設定
- [ ] 予算設定
  - [ ] 月次予算の入力
  - [ ] 年間予算の設定
- [ ] KPI目標値設定
  - [ ] 登録→初回率の目標
  - [ ] 初回→面接率の目標
  - [ ] 面接→成約率の目標
  - [ ] 成約単価の目標
- [ ] 通知設定
  - [ ] 通知の有効/無効
  - [ ] メール通知の設定

---

## 7. 認証・認可（優先度：高）

### 7.1 認証
- [ ] Email/Passwordログイン
- [ ] ログアウト処理
- [ ] セッション管理
- [ ] パスワード変更

### 7.2 認可
- [ ] ロールベースアクセス制御
  - [ ] 管理者：全権限
  - [ ] ユーザー：担当データのみ
- [ ] RLS（Row Level Security）の設定

---

## 8. データベース（優先度：高）

### 8.1 スキーマの確認・修正
- [ ] `contracts.contracted_at`が必須であることを確認
- [ ] `interviews.start_at`が必須であることを確認
- [ ] `candidates.registered_at`が必須であることを確認
- [ ] `projects.expected_amount`カラムの追加
- [ ] `projects.probability`カラムの追加

### 8.2 マイグレーション
- [ ] 既存データのマイグレーション
- [ ] データ整合性の確認
- [ ] インデックスの最適化

### 8.3 RLS設定
- [ ] 各テーブルのRLS有効化
- [ ] ポリシーの設定

---

## 9. テスト（優先度：中）

### 9.1 単体テスト
- [ ] KPI計算ロジックのテスト
- [ ] 期間フィルタリングのテスト
- [ ] バリデーションのテスト

### 9.2 結合テスト
- [ ] 画面間の遷移テスト
- [ ] データの整合性テスト

### 9.3 E2Eテスト
- [ ] 主要なユースケースのテスト

---

## 10. デプロイ（優先度：低）

### 10.1 環境構築
- [ ] Supabaseプロジェクトの作成
- [ ] Vercelへのデプロイ
- [ ] 環境変数の設定

### 10.2 本番データ移行
- [ ] CSVデータのインポート
- [ ] データ検証

---

## 進捗管理

### 完了した項目
- [x] 画面の基本レイアウト作成
- [x] モックデータでの画面表示
- [x] 認証機能の基本実装
- [x] 要件ドキュメントの作成

### 次のステップ
1. ダッシュボードの期間フィルタリング実装
2. 予算管理機能の実装
3. 求職者管理のCRUD機能実装
4. 成約管理の編集機能実装

---

## 更新履歴

- 2025-01-22: 初版作成
