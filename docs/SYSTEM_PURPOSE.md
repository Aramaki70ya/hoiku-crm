# システム目的と設計思想

> **重要**: このドキュメントはAIエージェントが最初に参照すべきドキュメントです。システムの目的と設計の基本方針を理解してから、他のドキュメントを参照してください。

## システムの目的

### なぜこのシステムが作られたか

Hoiku CRMは、**複数のスプレッドシート（CSV）に分散している求職者情報、進捗管理、面接日程を一元管理する**ために開発されました。

### 解決すべき課題

1. **データの分散**: 連絡先マスタ、担当者別進捗シート、月別面接管理シートが独立しており、転記コストが発生
2. **重複管理**: 同じ求職者情報が複数シートに存在し、片方の更新が他に反映されない
3. **ID管理の欠如**: 同姓同名や表記揺れによる取り違えリスク
4. **可視化の限界**: 「誰が」「今」「どのフェーズに」「何人いるか」を瞬時に把握できない

### 目指す姿

- **SSOT (Single Source of Truth)**: 全てのデータが1つのデータベースに統合され、どこから見ても最新情報が表示される
- **プロセス標準化**: 担当者ごとの属人的な管理手法をシステムフローとして統一
- **高度なUI/UX**: 複雑な入力項目を整理された画面で入力・閲覧でき、ダッシュボードで数値を可視化

## 設計の基本方針

### 1. データの一元管理

**原則**: すべてのデータは1つのデータソース（Supabase）から取得し、1つのデータソースに保存する

- **現状（プロトタイプ）**: `src/lib/mock-data.ts`からデータを取得（開発・デモ用）
- **将来（本番）**: Supabaseからデータを取得・保存
- **例外**: タイムラインイベントは一時的にlocalStorageを使用（画面間での共有のため）

### 2. ユーザー中心の設計

**原則**: ユーザー（コンサルタント）が業務を効率的に行えることを最優先とする

- 複雑な操作を避け、直感的なUIを提供
- よく使う機能はすぐにアクセスできる場所に配置
- データの入力・更新は最小限の手順で完了できるようにする

### 3. データの整合性

**原則**: データの整合性を常に保つ

- 求職者のステータスを変更したら、関連するすべての画面で即座に反映される
- 面接一覧で担当者を変更したら、求職者詳細の担当者も自動的に更新される
- ステータスが「成約（closed_won）」になったら、自動的にcontractsテーブルにレコードを作成する

### 4. 可視化と分析

**原則**: 数値や進捗を視覚的に把握できるようにする

- ダッシュボードでKPIや予算達成状況を一目で確認できる
- 目標と実績を並べて表示し、乖離を可視化する
- プロセス別の進捗を数値と割合で表示する

## 重要な制約事項

### 変更してはいけない原則

1. **求職者IDの形式**: 8桁の数字形式（例: 20206138）を維持する。既存データとの互換性のため
2. **ステータス遷移ルール**: ビジネスルールに基づいたステータス遷移を維持する（詳細は`BUSINESS_RULES.md`参照）
3. **データソースの優先順位**: 
   - 本番環境ではSupabaseを優先
   - プロトタイプではmock-dataを使用
   - localStorageは一時的なデータ共有のみに使用

### 技術的制約

1. **フロントエンドのみ**: 現時点ではフロントエンドのみ実装。バックエンドAPIはSupabaseが提供
2. **認証**: Google OAuth経由でSupabase Authを使用（将来的な実装）
3. **状態管理**: ReactのuseStateとuseMemoを使用。複雑な状態管理ライブラリは使用しない

## システムの構成

### 技術スタック

- **Frontend**: Next.js 14 (App Router) + Tailwind CSS + Shadcn/UI
- **Hosting**: Vercel
- **Database**: Supabase (PostgreSQL)
- **認証**: Supabase Auth + Google OAuth

### ディレクトリ構造

```
hoiku-crm/
├── src/
│   ├── app/              # ページコンポーネント（Next.js App Router）
│   ├── components/        # 再利用可能なコンポーネント
│   │   ├── layout/       # レイアウトコンポーネント（サイドバー、ヘッダー）
│   │   └── ui/           # UIコンポーネント（Shadcn/UI）
│   ├── hooks/            # カスタムフック
│   ├── lib/              # ユーティリティ関数、データアクセス
│   │   ├── mock-data.ts  # モックデータ（プロトタイプ用）
│   │   └── supabase/     # Supabaseクライアント
│   └── types/            # TypeScript型定義
└── docs/                 # ドキュメント
```

## AIエージェント向けの重要な指針

### 判断に迷った時は

1. **まずこのドキュメントを確認**: システムの目的と設計方針を再確認
2. **ユーザーの意図を考える**: この機能はユーザーが何をしたいために存在するか
3. **データの整合性を保つ**: 変更が他の画面やデータに影響しないか確認
4. **既存のパターンに従う**: 既存のコードと同じパターンで実装する

### 変更を加える前に確認すべきこと

- この変更はシステムの目的に沿っているか？
- データの整合性を損なわないか？
- 既存の機能を壊さないか？
- ユーザーの使いやすさを損なわないか？

### よくある判断ミス

1. **データソースの混同**: mock-dataとSupabaseを混同しない
2. **状態管理の過剰な複雑化**: シンプルなuseStateで十分なのに、複雑な状態管理を導入しない
3. **UIの一貫性の欠如**: 既存のUIパターンに従わず、新しいスタイルを導入しない
4. **ビジネスロジックの無視**: ステータス遷移ルールなどのビジネスルールを無視しない

## 関連ドキュメント

- [画面仕様とビジネスロジック](./SCREEN_LOGIC.md) - 各画面の詳細仕様
- [データフローと状態管理](./DATA_FLOW.md) - データの流れ
- [ビジネスルール集](./BUSINESS_RULES.md) - システムの動作ルール
- [AIエージェント向け判断ガイド](./AI_AGENT_GUIDE.md) - 判断に迷った時のガイド
