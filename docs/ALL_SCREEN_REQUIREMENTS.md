# Hoiku CRM 全画面機能要件書

このドキュメントは、各画面の機能要件と使い方を詳細に記載しています。

---

## 目次

1. [ダッシュボード（全体サマリー）](#1-ダッシュボード全体サマリー)
2. [求職者管理](#2-求職者管理)
3. [成約管理](#3-成約管理)
4. [面接一覧](#4-面接一覧)
5. [求職者詳細](#5-求職者詳細)
6. [設定画面](#6-設定画面)

---

## 1. ダッシュボード（全体サマリー）

### 画面URL
`/`

### 画面の目的
経営層や管理者が全体の進捗を一目で把握するための画面。予算達成状況、KPI、プロセス別の進捗を可視化する。

### 主要機能

#### 1.1 期間選択機能
| 要素 | 機能 | 詳細 |
|------|------|------|
| 「当月」ボタン | 当月のデータを表示 | 現在の月のデータをフィルタリング |
| 「前月」ボタン | 前月のデータを表示 | 前月のデータをフィルタリング |
| 「指定期間」ボタン | 任意の期間を指定 | Popoverで開始日・終了日を入力 |

**必須実装事項**:
- 予算は期間ごとに設定できる必要がある
- 売上データは必ず日時（`contracts.contracted_at`）と紐付けられている必要がある
- すべてのデータを選択期間でフィルタリングする

#### 1.2 予算達成状況カード
| 表示項目 | データソース | 計算方法 |
|----------|-------------|----------|
| 予算 | `settings`テーブル | 月次予算を取得 |
| 売上 | `contracts.revenue_including_tax` | 選択期間内の合計 |
| Aヨミ | `projects` | 確度Aの案件の合計金額 |
| Bヨミ | `projects` | 確度Bの案件の合計金額 |
| 不足金額 | 計算値 | 予算 - 売上 - Aヨミ - Bヨミ |

#### 1.3 KPIカード（目標数値の前提条件）
| KPI | 計算式 | データソース |
|-----|--------|-------------|
| 登録→初回率 | (初回済み人数 / 選択期間内の登録者数) × 100 | `candidates.registered_at`, `candidates.status` |
| 初回→面接率 | (選択期間内に面接設定した人数 / 初回済み人数) × 100 | `interviews.start_at`, `candidates.status` |
| 面接→成約率 | (選択期間内の成約人数 / 選択期間内に面接設定した人数) × 100 | `contracts.contracted_at`, `interviews.start_at` |
| 成約単価 | 選択期間内の売上合計 / 選択期間内の成約人数 | `contracts.revenue_including_tax`, `contracts.contracted_at` |

#### 1.4 プロセス進捗カード
8つのプロセス（ステータス）別に件数と割合を表示:
- リード管理
- 面談フェーズ
- 提案フェーズ
- 面接フェーズ
- 内定確認中
- 内定承諾
- 内定辞退
- フォロー・ロスト

#### 1.5 登録者数サマリーカード
- 今月の応募数
- 全体の人数
- 流入経路ごとの新規人数（LINEを除く）
- 流入経路割合（LINEを除く）

### ユースケース
1. **月次レビュー**: 当月ボタンを押して、今月の予算達成状況を確認
2. **前月比較**: 前月ボタンを押して、先月の実績と比較
3. **四半期分析**: 指定期間で3ヶ月分を選択して四半期の傾向を分析

---

## 2. 求職者管理

### 画面URL
`/candidates`

### 画面の目的
すべての求職者を一覧表示し、検索・フィルタリング・ステータス変更を行う。

### 主要機能

#### 2.1 タブ切り替え
| タブ | 表示内容 |
|------|----------|
| 全体 | すべての求職者 |
| 今日のタスク | アクティブな求職者を優先度順でソート |

#### 2.2 検索・フィルター機能
| フィルター | 対象項目 |
|------------|----------|
| 検索バー | 氏名、ID、電話番号 |
| ステータスフィルター | 求職者のステータス |
| 担当者フィルター | 担当コンサルタント |

#### 2.3 一覧テーブル
| カラム | 内容 | 編集可否 |
|--------|------|----------|
| ランク | 求職者の重要度（A/B/C） | 不可 |
| 優先度 | アプローチ優先度（S/A/B/C） | 可（ドロップダウン） |
| 氏名 | 氏名、年齢、住所 | 不可（詳細へのリンク） |
| 連絡先 | 電話番号、メールアドレス | 不可 |
| 雇用形態 | 希望雇用形態 | 可（ドロップダウン） |
| ステータス | 現在のステータス | 可（ドロップダウン） |
| 担当者 | 担当コンサルタント | 可（ドロップダウン） |

#### 2.4 新規登録機能
- 「+ 新規登録」ボタンで新規求職者を登録

### ユースケース
1. **日次タスク確認**: 「今日のタスク」タブで優先度順に対応すべき求職者を確認
2. **ステータス更新**: ステータスを変更して進捗を更新
3. **担当者割り当て**: 新規登録者に担当者を割り当て

---

## 3. 成約管理

### 画面URL
`/contracts`

### 画面の目的
成約した求職者の売上・入金状況を管理する。

### 主要機能

#### 3.1 フィルター機能
| フィルター | 内容 |
|------------|------|
| 月選択 | 表示する月を選択（2025年1月など） |
| 担当者フィルター | 担当者で絞り込み |

#### 3.2 サマリーカード
| カード | 表示内容 |
|--------|----------|
| 成約件数 | 選択月の成約件数 |
| 売上（税抜） | 合計売上 |
| 入金済み | 入金済み件数 |
| 入金待ち | 入金待ち件数 |

#### 3.3 成約一覧テーブル
| カラム | 内容 | 編集可否 |
|--------|------|----------|
| 氏名 | 成約者名（詳細へのリンク） | 不可 |
| 担当 | 担当コンサルタント | 不可 |
| 経由 | 流入経路 | 不可 |
| 承諾日 | 成約承諾日 | 可 |
| 売上 | 売上（税抜/税込） | 可 |
| 請求書発行 | 請求書発行状態 | 可 |
| 入金予定日 | 入金予定日 | 可 |
| 入金日 | 実際の入金日 | 可 |
| 操作 | 編集・キャンセル対応ボタン | - |

#### 3.4 キャンセル対応機能
成約後に入社を辞退した場合の返金情報を管理:
- 返金あり/なし（チェックボックス）
- 返金日（返金ありの場合のみ必須）
- 返金額（返金ありの場合のみ必須）
- 備考（キャンセル理由）

### ユースケース
1. **月次売上確認**: 当月の成約件数と売上を確認
2. **入金管理**: 入金待ちの成約を確認し、入金日を記録
3. **キャンセル対応**: 入社辞退時にキャンセル情報を登録

---

## 4. 面接一覧

### 画面URL
`/interviews`

### 画面の目的
すべての面接を一覧表示し、ステータス・担当者を管理する。

### 主要機能

#### 4.1 フィルター機能
| フィルター | 内容 |
|------------|------|
| 月選択 | 表示する月を選択 |
| ステータスフィルター | 予定/完了/キャンセル |
| 担当者フィルター | 担当者で絞り込み |

#### 4.2 サマリーカード
| カード | 表示内容 |
|--------|----------|
| 予定 | 予定されている面接数 |
| 完了 | 完了した面接数 |
| 今月の成約 | 今月成約した件数 |

#### 4.3 タブ切り替え
| タブ | 表示内容 |
|------|----------|
| すべて | すべての面接 |
| 予定 | 予定されている面接のみ |
| 完了 | 完了した面接のみ |

#### 4.4 面接一覧テーブル
| カラム | 内容 | 編集可否 |
|--------|------|----------|
| 日時 | 面接日時 | 不可 |
| 求職者 | 求職者名 | 不可 |
| 面接先 | 園名・法人名 | 不可 |
| 場所 | 面接場所/URL | 不可 |
| 担当者 | 担当コンサルタント | 可 |
| ステータス | 予定/完了/キャンセル | 可 |
| フィードバック | 面接結果・所感 | 可 |

### ユースケース
1. **本日の面接確認**: 今日の予定面接を確認
2. **面接結果記録**: 完了した面接にフィードバックを記録
3. **担当者変更**: 面接の担当者を変更

---

## 5. 求職者詳細

### 画面URL
`/candidates/[id]`

### 画面の目的
個別の求職者の詳細情報を表示・編集する。

### 主要機能

#### 5.1 ヘッダー情報
| 表示項目 | 内容 |
|----------|------|
| 氏名 | 求職者の氏名 |
| ID | 求職者ID |
| ステータス | 現在のステータス（変更可能） |
| 基本情報 | 年齢、住所 |

#### 5.2 ヨミ情報カード
| 項目 | 内容 |
|------|------|
| ヨミ確度 | A/B/C/D（ドロップダウン） |
| ヨミ金額 | 金額入力（確度選択後に入力可能） |
| 保存ボタン | ヨミ情報を保存 |

#### 5.3 基本情報カード
| 項目 | 内容 |
|------|------|
| 電話番号 | 求職者の電話番号 |
| メール | メールアドレス |
| 住所 | 住所 |
| 希望職種 | 希望する職種 |
| 希望雇用形態 | 正社員/パートなど |
| 保有資格 | 保育士/看護師など |
| 登録日 | システムへの登録日 |
| 担当者 | 担当コンサルタント |

#### 5.4 タブコンテンツ
| タブ | 内容 |
|------|------|
| タイムライン | 活動履歴の時系列表示 |
| 選考状況 | 関連する案件（プロジェクト）一覧 |
| メモ | メモの表示・追加・編集 |

#### 5.5 操作ボタン
| ボタン | 機能 |
|--------|------|
| メモ追加 | 新規メモを追加 |
| 案件追加 | 新規案件を追加 |
| 編集 | 基本情報を編集 |

### ユースケース
1. **詳細確認**: 求職者の詳細情報を確認
2. **タイムライン確認**: 過去の対応履歴を確認
3. **ヨミ情報更新**: ヨミ確度と金額を更新
4. **メモ追加**: 対応内容をメモとして記録

---

## 6. 設定画面

### 画面URL
`/admin`

### 画面の目的
システム設定、ユーザー管理、マスタ管理を行う。

### 主要機能

#### 6.1 ユーザー管理
- ユーザー一覧表示
- ユーザー追加・編集・削除
- パスワードリセット

#### 6.2 マスタ管理
- 媒体（流入経路）マスタ管理
- ステータスマスタ管理

#### 6.3 システム設定
- 予算設定
- KPI目標値設定
- 通知設定

---

## 7. 共通機能

### 7.1 サイドバーナビゲーション
| メニュー項目 | 画面 |
|--------------|------|
| 全体サマリー | `/` |
| ダッシュボード | `/dashboard-summary` |
| 求職者管理 | `/candidates` |
| 成約管理 | `/contracts` |
| 面接一覧 | `/interviews` |
| 設定 | `/admin` |

### 7.2 ヘッダー
- 検索バー（全画面検索）
- 通知アイコン（未読通知バッジ）
- ユーザー情報

### 7.3 認証
- ログイン画面（`/login`）
- Email/Password認証
- Google OAuth（将来対応）

---

## 8. データベース要件

### 8.1 必須カラム
| テーブル | カラム | 用途 |
|----------|--------|------|
| `candidates` | `registered_at` | 登録日（期間フィルタリング用） |
| `contracts` | `contracted_at` | 成約確定日時（期間フィルタリング用） |
| `interviews` | `start_at` | 面接日時（期間フィルタリング用） |
| `projects` | `expected_amount` | ヨミ金額 |
| `projects` | `probability` | ヨミ確度（A/B/C/D） |

### 8.2 期間フィルタリングの実装
すべての集計値は選択期間に応じてフィルタリングする必要がある:
- 売上: `contracts.contracted_at`が期間内
- 登録者数: `candidates.registered_at`が期間内
- 面接数: `interviews.start_at`が期間内
- 成約数: `contracts.contracted_at`が期間内

---

## 9. 今後の実装優先度

### 高優先度
- [ ] 期間フィルタリングの実装（ダッシュボード）
- [ ] 予算管理機能（設定画面）
- [ ] 売上と日時の紐付け確認

### 中優先度
- [ ] 求職者の新規登録・編集機能
- [ ] 面接の新規登録・編集機能
- [ ] ヨミ金額の入力・更新機能

### 低優先度
- [ ] 通知機能（面接リマインダー等）
- [ ] レポート出力機能（Excel/PDF）
- [ ] モバイルアプリ化

---

## 更新履歴

- 2025-01-22: 初版作成
